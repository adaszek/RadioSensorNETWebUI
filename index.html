<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Radio Sensor NET WebUI</title>

    <link rel="stylesheet" src="/dg/dygraph.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/dg/dygraph.js"></script>
</head>

<body>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/">Locations</a></li>
                <li><a href="/devices">Devices</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <table class="table table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>#</th>
                            <td>Device ID</td>
                            <td>Device name</td>
                            <td>Location</td>
                            <td>Device functions</td>
                            <td>Last active</td>
                            <td>Status</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td>211</td>
                            <td>unnamed</td>
                            <td>biuro</td>
                            <td>temperature; humidity; voltage</td>
                            <td>34 seconds ago</td>
                            <td>
                                <span class="label label-success">Ok</span>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>2</td>
                            <td>unnamed</td>
                            <td>biuro</td>
                            <td>temperature; humidity; voltage</td>
                            <td>34 seconds ago</td>
                            <td>
                                <span class="label label-danger">Error</span>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td>45</td>
                            <td>unnamed</td>
                            <td>biuro</td>
                            <td>temperature; humidity; voltage</td>
                            <td>34 seconds ago</td>
                            <td>
                                <span class="label label-default">Offline</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1">
                <ul class="nav nav-pills nav-stacked">
                    <li role="presentation" class="active"><a href="#">Home</a></li>
                    <li role="presentation"><a href="#">Profile</a></li>
                    <li role="presentation"><a href="#">Messages</a></li>
                </ul>
            </div>
            <div class="col-md-11">
                <div class="jumbotron">
                    <div id="graphdiv3" style="width: 100%;"></div>
                    <br />
                    <div>
                        <form class="form-inline" id="type_selection_form" action="">
                            <div class="form-group">
                                <label for="sensor_id">Sensor ID</label>
                                <select class="form-control input-sm" name="sensor_id" id="sid">
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="measurement_id">Measurement ID</label>
                                <select class="form-control input-sm" name="measurement_id" id="mid">
                                    <option value="temperature">temperature</option>
                                    <option value="humidity">humidity</option>
                                    <option value="voltage">voltage</option>
                                </select>
                            </div>
                            <input type="submit" id="modify_view" value="Show" class="btn btn-primary"/>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var socket = io();
        var g3 = new Dygraph(document.getElementById("graphdiv3"), [], {
            dateWindow: [Date.now() - 60000 * 60 * 24, Date.now()],
            //drawPoints: true,
            fillGraph: true,
            //rollPeriod: 5,
            //showRoller: true,
            //showRangeSelector: true,
            labels: ['Time', 'Measurement']
        })

        /*
        $("#sid").change(function(data) {
            check_selected_sensor();
        });
        */

        $("#type_selection_form").submit(function() {
            var sensor = $("#sid").find(":selected").text();
            var measurement = $("#mid").find(":selected").text();
            socket.emit('data_request', {
                "sid": sensor,
                "mid": measurement
            });
            return false;
        });

        socket.on('sensor_list', function(data) {
            $.each(data, function(key, value) {
                $("#sid")
                    .append($("<option></option>")
                        .attr("value", key)
                        .text(value))
            });
            var sensor = $("#sid").find(":selected").text();
            var measurement = $("#mid").find(":selected").text();
            socket.emit('data_request', {
                "sid": sensor,
                "mid": measurement
            });
        });

        socket.on('data_response', function(data) {
            var array = [];
            for (var key in data) {
                array.push([
                    new Date(parseInt(key) * 1000),
                    parseFloat(data[key])
                ]);
            }
            g3.updateOptions({
                'file': array,
                dateWindow: [Date.now() - 60000 * 60 * 24, Date.now()]
            });
        });
    </script>
</body>

</html>
