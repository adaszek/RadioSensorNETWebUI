<!doctype html>
<html>
  <head>
    <title>Radio Sensor NET WebUI</title>
    <script type="text/javascript" src="/dg/dygraph.js"></script>
    <link rel="stylesheet" src="/dg/dygraph.css" />
  </head>
  <body>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <div id="graphdiv3" style="width:1500px; height:900px;"></div>
    <div>
        <form id="type_selection_form" action="">
            <select name="sensor_id" id="sid">
            </select>
            <select name="measurement_id" id="mid">
                <option value="temperature">temperature</option>
                <option value="humidity">humidity</option>
                <option value="voltage">voltage</option>
            </select>
            <input type="submit" id="modify_view" value="Show" />
        </form>
    </div>
    <script>
        var socket = io();
        var g3 = new Dygraph(document.getElementById("graphdiv3"), 
            [],
            {
                dateWindow: [ Date.now() - 60000*60*24, Date.now() ],
                //drawPoints: true,
                fillGraph: true,
                //rollPeriod: 50,
                showRoller: true,
                showRangeSelector: true,
                labels: ['Time', 'Measurement']
            }
        )

        /*
        $("#sid").change(function(data) {
            check_selected_sensor();
        });
        */

        $("#type_selection_form").submit(function() {
            var sensor = $("#sid").find(":selected").text();
            var measurement = $("#mid").find(":selected").text();
            socket.emit('data_request', { "sid": sensor, "mid": measurement });
            return false;
        });

        socket.on('sensor_list', function(data) {
            $.each(data, function(key, value) {
                $("#sid")
                    .append($("<option></option>")
                    .attr("value", key)
                    .text(value))
            });
            var sensor = $("#sid").find(":selected").text();
            var measurement = $("#mid").find(":selected").text();
            socket.emit('data_request', { "sid": sensor, "mid": measurement });
        });

        socket.on('data_response', function(data) {
            var array = [];
            for(var key in data) {
                array.push([
                    new Date(parseInt(key)*1000),
                    parseFloat(data[key])
                ]);
            }
            g3.updateOptions( { 'file': array, dateWindow: [ Date.now() - 60000*60*24, Date.now() ] } );
        });

    </script>
  </body>
</html>
